<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" horizontalScrollPolicy="off" verticalScrollPolicy="off"  xmlns:local="*"  >
<local:adLoading id="loading" visible="false" scaleX="0.2" scaleY="0.2">	
</local:adLoading>
	<mx:Script>
		<![CDATA[
			import common.data.StringDef;
			import mx.controls.Label;
			import mx.core.UIComponent;
			import flash.net.navigateToURL;
		    private var _url:String;//广告地址
		    private var _link:String;//广告连接
		    private var _load:Loader = new Loader();
		    private var _out:UIComponent = new UIComponent();
		    private var _time:Timer;
		    private var _text:Label;
			public function set url(value:String):void{
				  _url = value;				
				  init();
			}
			public function set link(value:String):void{
				_link = value;
			}
			//设置对象直接传进来
			public function set value(value:Object):void{
				_url = value["url"];
				_link = value["link"];
				init();
			}
			private function init():void{	
				if(loading!=null){
					loading.visible = true;	
				}
				if(this.getChildByName("textName")!=null){
					this.removeChild(this.getChildByName("textName") as DisplayObject);
				}
			
				if(_url!=""){
				
				    _load.contentLoaderInfo.addEventListener(Event.COMPLETE,onComplete);
				    _load.contentLoaderInfo.addEventListener(ProgressEvent.PROGRESS,onProgress);
				    _load.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR,onError);
				    _load.load(new URLRequest(_url));
				    if(loading!=null){
				    	 loading.x = (this.width-15)/2;
				   		 loading.y = (this.height-15)/2;   
				    }
			    
				}
								
			}
			//加载完成后显示 
			private function onComplete(evt:Event):void{
				if(loading!=null){
					removeChild(loading);
					loading=null;
				} 	 
				//loading.visible = false;	
				addChild(_out);				
				_load.width = this.width;
				_load.height = this.height;				
				_out.addChild(_load);
				if(_link!= null){				
					_out.buttonMode=true;				 
					_load.addEventListener(MouseEvent.CLICK,onClick);
				}
			}
			private function onError(evt:IOErrorEvent):void{
				_time = new Timer(10000,1);
				_time.addEventListener(TimerEvent.TIMER_COMPLETE,onTimer);
				_time.start();
			}
			private function onTimer(evt:TimerEvent):void{
				  _text = new Label();
				 _text.name="textName";
		        _text.htmlText = StringDef.OVER_TIME;
		        this.addChild(_text);
		        _text.x = (this.width-_text.width)/2;
				_text.y = (this.height-_text.height)/2;   
			}
			private function onProgress(evt:ProgressEvent):void{
				
			}
			private function onClick(evt:MouseEvent):void{
				 navigateToURL(new URLRequest(_link),"_blank");
				
			}
		]]>
	</mx:Script>
</mx:Canvas>
